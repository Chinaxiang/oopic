## ğŸš€ å–”å–”å›¾åºŠ

ä½œä¸ºä¸€åITæ°‘å·¥ï¼Œå¹³æ—¶å–œæ¬¢å†™ä¸€äº›æ–‡æ¡£ï¼Œåšå®¢ï¼Œå¹¶ä¸”æ¯”è¾ƒå–œæ¬¢ Markdown è¯­æ³•ï¼Œä½†ä¸€ç›´ä»¥æ¥æ¯”è¾ƒå›°æ‰°çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯æ’å…¥å›¾ç‰‡éº»çƒ¦ï¼Œå› ä¸ºæ–‡æ¡£å¯èƒ½ä¼šæ”¾ç½®åˆ°å„ä¸ªç½‘ç«™ä¸­ï¼Œå¦‚ä½•ä¿è¯å›¾ç‰‡èƒ½å¤Ÿæ­£å¸¸æ˜¾ç¤ºæ˜¯ä¸€ä»¶å¤´ç—›çš„äº‹æƒ…ã€‚å¦å¤–ï¼Œå›¾ç‰‡ä¸Šä¼ è¦è¶³å¤Ÿæ–¹ä¾¿ï¼Œæ­£å¥½ Chrome æ’ä»¶èƒ½å®Œå…¨æ»¡è¶³éœ€æ±‚ã€‚

### ç‰¹ç‚¹

- æ”¯æŒç‚¹é€‰/æ‹–æ‹½/æœ¬åœ°ç²˜è´´3ç§æ–¹å¼ä¸Šä¼ å›¾ç‰‡è‡³å›¾åºŠ
- æ”¯æŒå³é”®ä¸Šä¼ ç½‘é¡µå›¾ç‰‡
- æ”¯æŒæ‰¹é‡ä¸Šä¼ 
- å¯ç”Ÿæˆå›¾ç‰‡é“¾æ¥,HTML,UBBå’ŒMarkdownå››ç§æ ¼å¼
- å†å²æµè§ˆï¼ˆä»…é™æµè§ˆå™¨æœ¬åœ°ç¼“å­˜ï¼Œæ¸…ç¼“å­˜å°†ä¼šå¤±æ•ˆï¼‰
- æ”¯æŒé…ç½®å¤šç§å­˜å‚¨åç«¯ï¼ˆé»˜è®¤é˜¿é‡Œäº‘ï¼‰
- ç¦»çº¿æ’ä»¶å®‰è£…ï¼Œå…ç¿»å¢™

å¥½ç”¨è®°å¾—ç»™ç‚¹å¥½è¯„å“Ÿã€‚é˜”ç»°çš„å°ä¼™ä¼´ä¹Ÿå¯ä»¥æ‰“èµä¸€ä¸‹ã€‚æ‰“èµå›¾åœ¨æœ€ä¸‹æ–¹ï¼Œé¿å…å½±å“å¤§å®¶é˜…è¯»ã€‚

> å•å¼ ä¸Šä¼ 

![](tmp/01.png)

> æ‰¹é‡ä¸Šä¼ 

![](tmp/02.png)

> ä¸Šä¼ å†å²è®°å½•

![](tmp/05.png)

### ä½¿ç”¨æŒ‡å—

ä½¿ç”¨å›¾åºŠåˆ† 3 æ­¥ï¼š

- æ‹¥æœ‰ chrome å†…æ ¸çš„ç°ä»£æµè§ˆå™¨ï¼ˆè¿™ä¸ªä¸å¤šè¯´äº†ï¼‰
- å¼€é€šé˜¿é‡Œäº‘OSS å­˜å‚¨å¹¶è·å– AK,SK
- å®‰è£…æ­¤æ’ä»¶å¹¶å®Œæˆé…ç½®ï¼ˆé…ç½®åŸŸåï¼ŒAK,SKï¼‰

#### å¼€é€šé˜¿é‡Œäº‘OSS

æ¨èé‡‡ç”¨ é˜¿é‡Œäº‘OSS ç”¨äºå­˜å‚¨å›¾ç‰‡ï¼ˆä¸ªäººå¯ä»¥æ³¨å†Œé˜¿é‡Œäº‘è´¦å·ï¼Œå¼€é€šOSSï¼Œæœ‰å…è´¹é¢åº¦ï¼ŒåŸºæœ¬å¤Ÿç”¨ï¼‰

ç™»å½•è¿›å…¥åˆ°æ§åˆ¶å°ï¼Œæœç´¢ å¯¹è±¡å­˜å‚¨ã€‚

![](https://oosnail.oss-cn-hangzhou.aliyuncs.com/2024/05/21/19/Km7KSS.png)

Bucket åˆ—è¡¨ï¼Œåˆ›å»º Bucket

![](https://oosnail.oss-cn-hangzhou.aliyuncs.com/2024/05/21/19/wKADyJ.png)

å¡«å†™å¿…è¦çš„ä¿¡æ¯ï¼Œé€‰æ‹©å¼€æ”¾å…¬å…±è¯»ï¼ˆé‡ç‚¹ï¼‰

![](https://oosnail.oss-cn-hangzhou.aliyuncs.com/2024/05/21/19/cfAkXK.png)

è¿›å…¥åˆ° Bucket ç‚¹å‡»æ¦‚è§ˆï¼Œå¯ä»¥çœ‹åˆ°å¤–ç½‘è®¿é—®ç‚¹

![](https://oosnail.oss-cn-hangzhou.aliyuncs.com/2024/05/21/19/hA4EHC.png)

è¿™ä¸ªè®¿é—®ç‚¹å°±æ˜¯ä¸‹é¢ç¤ºä¾‹ä¸­æåˆ°çš„ upUrl çš„ä¸€éƒ¨åˆ†ã€‚

å¦å¤–ï¼Œè¿˜éœ€è¦åˆ›å»ºä½ çš„ AK, SKï¼Œ ç‚¹å¤´åƒ - AccessKey ç®¡ç†ï¼Œåˆ›å»º AccessKey å¹¶ä¿å­˜ä¸‹æ¥ã€‚

![](https://oosnail.oss-cn-hangzhou.aliyuncs.com/2024/05/21/19/2pxkij.png)

![](https://oosnail.oss-cn-hangzhou.aliyuncs.com/2024/05/21/19/WB2sai.png)

#### å®‰è£…æ’ä»¶å¹¶é…ç½®

ä¸‹è½½æœ€æ–°å®Œæ•´ä»£ç å¹¶è§£å‹åˆ°ç£ç›˜æŸä¸€ä½ç½®ï¼ˆä»»ä½•ä½ç½®éƒ½å¯ä»¥ï¼‰ã€‚

https://github.com/bytesops/oopic/archive/refs/heads/master.zip

å¦‚ï¼šE:\data\oopic-master

![](https://oosnail.oss-cn-hangzhou.aliyuncs.com/2024/05/21/19/d5BJTJ.png)

åœ¨æµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥ï¼šchrome://extensions/

ç„¶åç‚¹å‡» åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åºï¼Œé€‰æ‹© oopic-master ç›®å½•ã€‚

![](https://oosnail.oss-cn-hangzhou.aliyuncs.com/2024/05/21/19/tcsJe7.png)

ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œå¯ä»¥å°†å…¶å›ºå®šè‡³æµè§ˆå™¨åœ°å€æ å³ä¾§ã€‚

![](https://oosnail.oss-cn-hangzhou.aliyuncs.com/2024/05/21/19/4s8Zjd.png)

ç„¶åå•å‡»å›¾æ ‡ï¼Œåœ¨å¼¹å‡ºçš„ä¸Šä¼ é¡µä¸­ï¼Œç‚¹å‡» è®¾ç½®/å†å² è¿›è¡Œæ’ä»¶é…ç½®ã€‚

![](https://oosnail.oss-cn-hangzhou.aliyuncs.com/2024/05/21/19/h5EZDW.png)

é…ç½®ä¸Šä¸€èŠ‚ä¸­è·å–çš„ é˜¿é‡Œäº‘OSS æ¥å…¥ç‚¹åŠä½ çš„ AK, SK

![](https://oosnail.oss-cn-hangzhou.aliyuncs.com/2024/05/21/19/eKrjKj.png)

#### ä½¿ç”¨äº¤æµ

å…³æ³¨æˆ‘çš„ä¸ªäººå·â€œæ–°è´¨ç¨‹åºçŒ¿â€å›å¤â€œå›¾åºŠâ€å³å¯è·å–äº¤æµç¾¤é“¾æ¥ã€‚

![](qrcode.jpg)

### é˜¿é‡Œäº‘OSSæ‰©å±•

é˜¿é‡Œäº‘OSS ä¸Šä¼ é‡‡ç”¨ PostObject æ¨¡å¼ï¼Œå¤§å®¶å¯ä»¥é˜…è¯»å…·ä½“çš„å‚æ•°æ–‡æ¡£ã€‚

https://help.aliyun.com/document_detail/31988.htm

é˜¿é‡Œäº‘OSSéœ€è¦ç»‘å®šè‡ªå®šä¹‰åŸŸååæ‰èƒ½æµè§ˆå™¨ç›´æ¥é¢„è§ˆï¼Œå¦åˆ™ä¼šå¼¹å‡ºä¸‹è½½ï¼Œä¸è¿‡ä¸å½±å“ä½œä¸ºå›¾åºŠçš„ä½¿ç”¨ï¼ˆä½¿ç”¨é˜¿é‡Œäº‘è‡ªå·±çš„åŸŸååœ¨ç½‘é¡µä¸­ä¹Ÿå¯ä»¥æ˜¾ç¤ºï¼Œæœ€ä¸‹é¢çš„æ‰“èµé“¾æ¥å°±æ˜¯ç”¨çš„aliyunçš„åŸŸåç›´æ¥æ˜¾ç¤ºçš„ï¼‰ã€‚

ä¸‹é¢æ˜¯æˆ‘ä½¿ç”¨æ¯•ç”ŸJSç»å­¦æ‰€å†™çš„ é˜¿é‡Œäº‘OSS ä¸Šä¼ ä»£ç ï¼Œä»…ä¾›å‚è€ƒï¼Œä¸Šä¼ å‚æ•°å¤§å®¶å¯ä»¥å¾®è°ƒã€‚

```
// æˆ‘çš„ bucket å« oosnail, ä½äº æ­å·åŒº
upUrl = 'https://oosnail.oss-cn-hangzhou.aliyuncs.com/';
// ak,sk ä½ æ‡‚çš„ï¼Œé‰´æƒç”¨çš„
var accessKey = 'ak';
var secretKey = 'sk';
// æ„å»ºå¯ä»¥è®¿é—®çš„åœ°å€
function parseRet(text, formData) {
    return upUrl + formData.get('key');
}
// æ„å»ºä¸Šä¼ è¡¨å•
function buildForm(file) {
    var policyText = {
        "expiration": new Date((Date.now() + 300000)).toISOString(),
        "conditions": [
            ["content-length-range", 0, 104857600]
        ]
    };
    var policyBase64 = Base64.encode(JSON.stringify(policyText));
    var signature = CryptoJS.enc.Base64.stringify(CryptoJS.HmacSHA1(policyBase64, secretKey));
    var data = new FormData();
    var key = new Date().format('yyyy/MM/dd/h/') + random_string(6) + get_suffix(file.name);
    // æ–‡ä»¶è·¯å¾„ï¼Œæˆ‘è®¾ç½®çš„ç±»ä¼¼ 2025/05/21/sdfesd.png è¿™æ ·çš„
    data.append('key', key);
    // ç­¾åç›¸å…³çš„ï¼Œå¯ä»¥å‚ç…§å®˜æ–¹æ–‡æ¡£
    data.append('policy', policyBase64);
    data.append('OSSAccessKeyId', accessKey);
    data.append('success_action_status', '200');
    data.append('signature', signature);
    // å¾…ä¸Šä¼ çš„æ–‡ä»¶
    data.append('file', file);
    return data;
}
```


### è‡ªå®šä¹‰æ‰©å±•

æœ‰ä¸€å®šå¼€å‘èƒ½åŠ›çš„å¯ä»¥æ ¹æ®å…¶ä»–å­˜å‚¨è¿›è¡Œæ‰©å±•ï¼Œæä¾›å¦‚ä¸‹èµ„æ–™ï¼š

- upUrl: è¯·æä¾›æ‚¨ä¸ªäººæœåŠ¡ç«¯ä¸Šä¼ æ¥å£å®Œå…¨è·¯å¾„ï¼ŒPOST è¡¨å•ä¸Šä¼ 
- buildForm(file): æ„å»ºè¡¨å•å‚æ•°æ–¹æ³•ï¼Œæ‚¨å¯ä»¥å¡«å†™ä¸ªäººè‡ªå®šä¹‰å­—æ®µè‡³formè¡¨å•ä¸­
- parseRet(text, formData): è§£æajaxå“åº”å†…å®¹ï¼Œè¿”å›å›¾ç‰‡çš„å®Œå…¨è®¿é—®è·¯å¾„ç”¨äºå¿«é€Ÿå¤åˆ¶åŠå†å²è®°å½•

```
// ä¸Šä¼ æ¥å£
upUrl = 'https://yoururl';
// æ„å»ºformè¡¨å•æ•°æ®ï¼Œfileè¡¨ç¤ºå¾…ä¸Šä¼ çš„æ–‡ä»¶
function buildForm(file) {
    var data = new FormData();
    data.append('file', file);
    return data;
}
// è¿”å›æœåŠ¡ç«¯å“åº”çš„å›¾ç‰‡è®¿é—®é“¾æ¥
function parseRet(text, formData) {
    var res = JSON.parse(text);
    var image_url = res.data;
    return image_url;
}
```

ä¾‹å¦‚æˆ‘ä¸ªäººè¿˜æœ‰ä¸€ä¸ª ä¸ƒç‰›äº‘å­˜å‚¨ çš„é…ç½®ç¤ºä¾‹å¦‚ä¸‹ï¼ˆä¸ƒç‰›äº‘ç°åœ¨æ²¡æœ‰å…è´¹åŸŸåç»‘å®šäº†ï¼Œéœ€è¦å¡«å†™è‡ªå·±å¤‡æ¡ˆçš„åŸŸåæ‰è¡Œï¼‰ï¼š

```
upUrl = 'https://upload.qiniup.com/';
var accessKey = 'ak';
var secretKey = 'sk';
var bucketHost = 'http://laijuba.qiniudn.com/';
function parseRet(text, formData) {
    var res = JSON.parse(text);
    var image_url = bucketHost + res.key;
    return image_url;
}
function buildForm(file) {
    var fileName = file.name;
    var flags = {
        deadline: Math.floor(Date.now() / 1000) + 300,
        scope: "laijuba",
        saveKey: "${year}/${mon}/${day}/$(etag)" + get_suffix(fileName)
    };
    var encodedFlags = urlsafeBase64Encode(JSON.stringify(flags));
    var encoded = CryptoJS.enc.Base64.stringify(CryptoJS.HmacSHA1(encodedFlags, secretKey));
    var encodedSign = base64ToUrlSafe(encoded);
    var uploadToken = accessKey + ':' + encodedSign + ':' + encodedFlags;
    var data = new FormData();
    data.append('token', uploadToken);
    data.append('file', file);
    return data;
}
```

### æ‰“èµé“¾æ¥

<table border="0">
<tr>
<td><img src="https://oosnail.oss-cn-hangzhou.aliyuncs.com/2024/05/21/18/ijRYdx.png"/></td>
<td><img src="https://oosnail.oss-cn-hangzhou.aliyuncs.com/2024/05/21/18/zPBSCJ.png"/></td>
</tr>
</table>

